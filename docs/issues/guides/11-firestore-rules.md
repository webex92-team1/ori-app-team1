# Issue #11: Firestoreã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã®æ•´å‚™

ä½œæ¥­ãƒ–ãƒ©ãƒ³ãƒï¼šfeature/issue-11-firestore-rules

## ğŸ¯ ã“ã®ã‚¿ã‚¹ã‚¯ã®ç›®çš„

Firestore ã¸ã®èª­ã¿æ›¸ãã‚’ `users/{uid}` ã«é™å®šã™ã‚‹ãƒ«ãƒ¼ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ã—ã€æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤å‰ã®æœ€ä½é™ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚’æ‹…ä¿ã—ã¾ã™ã€‚

---

## ğŸ“ ä½œæ¥­ã§è§¦ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«

- `firebase/firestore.rules`ï¼ˆæ–°è¦ä½œæˆï¼‰

âš ï¸ **ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯è§¦ã‚‰ãªã„**

- `src/lib/firestore.js`
- `src/lib/firebase.js`
- `src/app/recipes/[id]/page.jsx`

---

## ğŸŒ² ä½œæ¥­ã‚’å§‹ã‚ã‚‹ã¨ã

ä½œæ¥­ãƒ–ãƒ©ãƒ³ãƒã«ç§»å‹•ã™ã‚‹

```bash
git checkout -b feature/issue-11-firestore-rules
```

---

## ğŸ§© ä½œæ¥­å†…å®¹ï¼ˆã‚„ã‚‹ã“ã¨ï¼‰

1. `firebase/firestore.rules` ã‚’æ–°è¦ä½œæˆ
2. `rules_version = '2'` ã‚’è¨˜è¼‰
3. `match /users/{uid}` ã®ã¿ã‚’è¨±å¯ã™ã‚‹ãƒ«ãƒ¼ãƒ«ã‚’å®šç¾©
4. èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã¿ read/write å¯èƒ½ã§ã€æœªèªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å…¨ã¦ reject
5. ãƒ«ãƒ¼ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®å…ˆé ­ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã‚³ãƒãƒ³ãƒ‰ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆï¼‰ã‚’è¨˜è¼‰

---

## âœ… å®Œæˆæ¡ä»¶ï¼ˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼‰

- [ ] `firebase/firestore.rules` ã« `rules_version = '2'` ã¨ `match /users/{uid}` ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹
- [ ] èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯è‡ªåˆ†ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã¿ read/write å¯èƒ½
- [ ] æœªèªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯å…¨ã¦ reject ã•ã‚Œã‚‹
- [ ] ãƒ«ãƒ¼ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã®å…ˆé ­ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã‚³ãƒãƒ³ãƒ‰ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆï¼‰ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹
- [ ] `firebase emulators:start --only firestore` å®Ÿè¡Œæ™‚ã«ãƒ«ãƒ¼ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œã€è­¦å‘ŠãŒå‡ºã¦ã„ãªã„

---

## ğŸ” å‹•ä½œç¢ºèªã®ã—ã‹ãŸ

1. `firebase emulators:start --only firestore` ã‚’å®Ÿè¡Œ
2. Emulator UI ã§ `users/another-user` ã‚’èª­ã¿æ›¸ãã—ã‚ˆã†ã¨ã—ã€èªè¨¼ UID ãŒä¸€è‡´ã—ãªã„å ´åˆã«æ‹’å¦ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
3. `firebase deploy --only firestore:rules` ã‚’å®Ÿè¡Œã—ã€ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãªã„ã“ã¨ã‚’ç¢ºèªï¼ˆæœ¬ç•ªåæ˜ å‰ã®ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³ã§ã‚‚å¯ï¼‰

---

## ğŸ”— é–¢é€£ãƒ»é †ç•ª

- ã“ã®ã‚¿ã‚¹ã‚¯ã®å‰ã«çµ‚ã‚ã£ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹: #3
- ã“ã®ã‚¿ã‚¹ã‚¯ãŒçµ‚ã‚ã£ãŸã‚‰é€²ã‚ã‚‰ã‚Œã‚‹ã‚‚ã®: -
- ãƒ©ãƒ™ãƒ«: `rules`, `infra`

---

## ğŸŒ² ä½œæ¥­ãŒå®Œäº†ã—ãŸã‚‰

1. `git add .`
2. `git commit -m "feat: Firestoreã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ«ãƒ¼ãƒ«ã‚’æ•´å‚™"`
3. `git push origin feature/issue-11-firestore-rules`
4. GitHubä¸Šã§PRã‚’ä½œæˆ

---

## ğŸ’¡ ã¡ã‚‡ã£ã¨ã—ãŸãƒ’ãƒ³ãƒˆ

- ãƒ«ãƒ¼ãƒ«ã®åŸºæœ¬æ§‹æ–‡:

```js
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /users/{uid} {
      allow read, write: if request.auth != null && request.auth.uid == uid;
    }
  }
}
```

- ãƒ‡ãƒ—ãƒ­ã‚¤ã‚³ãƒãƒ³ãƒ‰: `firebase deploy --only firestore:rules`

---

## ğŸ’¬ ãƒ¡ãƒ¢ãƒ»è³ªå•ï¼ˆå¿…è¦ãªã‚‰ï¼‰

- Firebase CLI ã®è¨­å®šï¼ˆã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆIDï¼‰ãŒãƒãƒ¼ãƒ å…¨ä½“ã§æƒã£ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„

